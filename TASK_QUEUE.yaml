# Micro-Task Execution Queue
# Ready for parallel Haiku 4.5 agent dispatch

metadata:
  decomposition_date: 2026-01-18
  total_tasks: 87
  total_waves: 6
  estimated_parallel_time_minutes: 60
  estimated_sequential_time_hours: 18
  parallelization_factor: 18x

waves:
  wave_1:
    duration_minutes: 10
    task_count: 5
    can_run_parallel: true
    dependencies: none
    tasks:
      - id: "1.1.1"
        name: "Add LLaVA Model Definitions to SUPPORTED_MODELS"
        agent: "typescript-dev"
        file: "src/lib/models/supported-models.ts"
        duration_minutes: 8
        parallel_group: "foundation"

      - id: "1.1.2"
        name: "Add getVisionModels Utility Function"
        agent: "typescript-dev"
        file: "src/lib/models/supported-models.ts"
        duration_minutes: 6
        parallel_group: "foundation"

      - id: "2.1.1"
        name: "Create ComfyUI Types File"
        agent: "typescript-dev"
        file: "src/lib/types/comfyui.ts"
        duration_minutes: 9
        parallel_group: "foundation"

      - id: "2.1.2"
        name: "Create ComfyUI API Client"
        agent: "typescript-dev"
        file: "src/lib/comfyui/client.ts"
        duration_minutes: 10
        parallel_group: "foundation"

      - id: "3.1.1"
        name: "Create Training Database Types"
        agent: "typescript-dev"
        file: "src/lib/types/training.ts"
        duration_minutes: 9
        parallel_group: "foundation"

  wave_2:
    duration_minutes: 12
    task_count: 6
    can_run_parallel: true
    dependencies: ["wave_1"]
    tasks:
      - id: "1.1.3"
        name: "Add Vision Model Display Badge Component"
        agent: "typescript-dev"
        file: "src/components/chat/VisionModelBadge.tsx"
        duration_minutes: 7
        parallel_group: "api_and_components"

      - id: "1.1.4"
        name: "Update MultiModelSelector to Show VRAM Requirements"
        agent: "typescript-dev"
        file: "src/components/chat/MultiModelSelector.tsx"
        duration_minutes: 8
        parallel_group: "api_and_components"

      - id: "2.1.3"
        name: "Create ComfyUI Status API Endpoint"
        agent: "typescript-dev"
        file: "src/app/api/comfyui/status/route.ts"
        duration_minutes: 8
        parallel_group: "api_and_components"

      - id: "2.1.4"
        name: "Create ComfyUI Execute API Endpoint"
        agent: "typescript-dev"
        file: "src/app/api/comfyui/execute/route.ts"
        duration_minutes: 9
        parallel_group: "api_and_components"

      - id: "2.1.5"
        name: "Create ComfyUI Schema API Endpoint"
        agent: "typescript-dev"
        file: "src/app/api/comfyui/schema/route.ts"
        duration_minutes: 8
        parallel_group: "api_and_components"

      - id: "3.1.2"
        name: "Create Supabase Migration for Training Tables"
        agent: "sql-dev"
        file: "supabase/migrations/20260118_create_training_tables.sql"
        duration_minutes: 10
        parallel_group: "api_and_components"

  wave_3:
    duration_minutes: 10
    task_count: 5
    can_run_parallel: true
    dependencies: ["wave_2"]
    tasks:
      - id: "1.2.1"
        name: "Create ImagePreviewGallery Component"
        agent: "typescript-dev"
        file: "src/components/chat/ImagePreviewGallery.tsx"
        duration_minutes: 9
        parallel_group: "state_and_ui"

      - id: "1.2.2"
        name: "Extend ChatInputArea with Vision Image State"
        agent: "typescript-dev"
        file: "src/components/chat/ChatInputArea.tsx"
        duration_minutes: 8
        parallel_group: "state_and_ui"

      - id: "1.2.3"
        name: "Create ImageUploadButton Component"
        agent: "typescript-dev"
        file: "src/components/chat/ImageUploadButton.tsx"
        duration_minutes: 9
        parallel_group: "state_and_ui"

      - id: "2.1.6"
        name: "Create Workflow Builder Store"
        agent: "typescript-dev"
        file: "src/lib/store/workflow-builder-store.ts"
        duration_minutes: 10
        parallel_group: "state_and_ui"

      - id: "3.1.3"
        name: "Create Supabase Client for Training"
        agent: "typescript-dev"
        file: "src/lib/db/training-client.ts"
        duration_minutes: 9
        parallel_group: "state_and_ui"

  wave_4:
    duration_minutes: 12
    task_count: 8
    can_run_parallel: true
    dependencies: ["wave_3"]
    tasks:
      - id: "1.2.4"
        name: "Add Vision Image Upload Handler to ChatInputArea"
        agent: "typescript-dev"
        file: "src/components/chat/ChatInputArea.tsx"
        duration_minutes: 8
        parallel_group: "integration"

      - id: "1.2.5"
        name: "Integrate ImageUploadButton into Toolbar"
        agent: "typescript-dev"
        file: "src/components/chat/ChatInputArea.tsx"
        duration_minutes: 7
        parallel_group: "integration"

      - id: "1.2.6"
        name: "Add ImagePreviewGallery to ChatInputArea"
        agent: "typescript-dev"
        file: "src/components/chat/ChatInputArea.tsx"
        duration_minutes: 6
        parallel_group: "integration"

      - id: "1.2.7"
        name: "Create Vision Analysis API Endpoint"
        agent: "typescript-dev"
        file: "src/app/api/vision/analyze/route.ts"
        duration_minutes: 10
        parallel_group: "integration"

      - id: "1.2.8"
        name: "Create useVisionAnalysis Hook"
        agent: "typescript-dev"
        file: "src/lib/hooks/useVisionAnalysis.ts"
        duration_minutes: 8
        parallel_group: "integration"

      - id: "2.2.1"
        name: "Create Workflow Canvas Component"
        agent: "typescript-dev"
        file: "src/components/workflow/WorkflowCanvas.tsx"
        duration_minutes: 10
        parallel_group: "integration"

      - id: "2.2.2"
        name: "Create Node Palette Component"
        agent: "typescript-dev"
        file: "src/components/workflow/NodePalette.tsx"
        duration_minutes: 8
        parallel_group: "integration"

      - id: "3.2.1"
        name: "Create Dataset Manager Core Logic"
        agent: "typescript-dev"
        file: "src/lib/dataset/manager.ts"
        duration_minutes: 10
        parallel_group: "integration"

  wave_5:
    duration_minutes: 10
    task_count: 6
    can_run_parallel: true
    dependencies: ["wave_4"]
    tasks:
      - id: "1.2.9"
        name: "Update Chat Message Type for Vision Content"
        agent: "typescript-dev"
        file: "src/lib/types.ts"
        duration_minutes: 6
        parallel_group: "advanced_features"

      - id: "1.3.1"
        name: "Update ChatOrchestrator for Vision Model Selection"
        agent: "typescript-dev"
        file: "src/components/chat/ChatOrchestrator.tsx"
        duration_minutes: 7
        parallel_group: "advanced_features"

      - id: "1.3.2"
        name: "Add Vision Model Selector Button to Chat Header"
        agent: "typescript-dev"
        file: "src/components/chat/ChatOrchestrator.tsx"
        duration_minutes: 8
        parallel_group: "advanced_features"

      - id: "1.3.3"
        name: "Create Vision Analysis UI Panel Component"
        agent: "typescript-dev"
        file: "src/components/chat/VisionAnalysisPanel.tsx"
        duration_minutes: 9
        parallel_group: "advanced_features"

      - id: "2.2.3"
        name: "Create Workflow Properties Panel"
        agent: "typescript-dev"
        file: "src/components/workflow/WorkflowProperties.tsx"
        duration_minutes: 9
        parallel_group: "advanced_features"

      - id: "3.2.2"
        name: "Create Dataset Upload API Endpoint"
        agent: "typescript-dev"
        file: "src/app/api/training/dataset/upload/route.ts"
        duration_minutes: 9
        parallel_group: "advanced_features"

  wave_6:
    duration_minutes: 10
    task_count: 5
    can_run_parallel: true
    dependencies: ["wave_5"]
    notes: "Task 1.2.10 is integration test - can run in parallel but validates sequential"
    tasks:
      - id: "1.3.4"
        name: "Integrate Vision Analysis into Message Input Flow"
        agent: "typescript-dev"
        file: "src/components/chat/ChatInputArea.tsx"
        duration_minutes: 9
        parallel_group: "finalization"

      - id: "2.2.4"
        name: "Create Main Workflow Editor View"
        agent: "typescript-dev"
        file: "src/components/workflow/WorkflowEditor.tsx"
        duration_minutes: 8
        parallel_group: "finalization"

      - id: "3.2.3"
        name: "Create useDatasetManager Hook"
        agent: "typescript-dev"
        file: "src/lib/hooks/useDatasetManager.ts"
        duration_minutes: 8
        parallel_group: "finalization"

      - id: "3.2.4"
        name: "Create Dataset Manager UI Component"
        agent: "typescript-dev"
        file: "src/components/training/DatasetManager.tsx"
        duration_minutes: 10
        parallel_group: "finalization"

      - id: "1.2.10"
        name: "Test Vision Model in MultiModelSelector (Integration Test)"
        agent: "qa-tester"
        type: "integration-test"
        duration_minutes: 8
        parallel_group: "finalization"
        notes: "Manual browser testing - validates Wave 1-5 completion"

execution_strategy:
  spawn_batches:
    batch_1:
      wave_number: 1
      agent_count: 5
      spawn_delay_seconds: 0
      description: "Foundation tasks - all independent"

    batch_2:
      wave_numbers: [2, 3]
      agent_count: 11
      spawn_delay_seconds: 600
      depends_on: ["batch_1"]
      description: "APIs and state management - wait for Wave 1"

    batch_3:
      wave_numbers: [4, 5, 6]
      agent_count: 19
      spawn_delay_seconds: 1200
      depends_on: ["batch_2"]
      description: "Integration and finalization - wait for Wave 2-3"

monitoring:
  success_criteria:
    - all_tasks_completed: true
    - typescript_compilation_passes: true
    - no_import_errors: true
    - integration_test_passes: true
    - git_diff_shows_expected_files: true

  error_handling:
    - retry_failed_tasks: true
    - max_retries: 2
    - log_all_errors_to: "build-log.json"
    - notify_on_critical_failure: true

validation_checklist:
  - name: "TypeScript Compilation"
    command: "tsc --noEmit"
    critical: true

  - name: "ESLint"
    command: "eslint . --max-warnings 0"
    critical: false

  - name: "Build"
    command: "npm run build"
    critical: true

  - name: "Integration Test"
    command: "manual-browser-test 1.2.10"
    critical: true

summary:
  total_micro_tasks: 87
  total_waves: 6
  estimated_parallel_execution_time: "60 minutes"
  estimated_sequential_time: "18 hours"
  parallelization_factor: "18x speedup"
  recommended_agent_pool_size: "30 agents (5 per wave backup)"
  critical_path_length: "6 waves"
